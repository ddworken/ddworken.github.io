<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://blog.daviddworken.com/posts/xss-in-pypi-and-uber/xss-in-pypi-and-uber/">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>XSS in pypi (and Uber!) | David Dworken's Blog</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://blog.daviddworken.com/posts/xss-in-pypi-and-uber/xss-in-pypi-and-uber/">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="David Dworken">
<link rel="prev" href="../../csv-injection-in-businessubercom/csv-injection-in-businessubercom/" title="CSV Injection in business.uber.com" type="text/html">
<link rel="next" href="../../xss-and-sqli-scanning-with-mitmproxy/" title="XSS and SQLi Scanning with mitmproxy" type="text/html">
<meta property="og:site_name" content="David Dworken's Blog">
<meta property="og:title" content="XSS in pypi (and Uber!)">
<meta property="og:url" content="http://blog.daviddworken.com/posts/xss-in-pypi-and-uber/xss-in-pypi-and-uber/">
<meta property="og:description" content="Uber's bug bounty program just went public, so it is time to write up some of the vulnerabilities I found in Uber. One of the more interesting ones was an XSS in archive.uber.com due to MIME sniffing.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-04-17T19:41:05-04:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://blog.daviddworken.com/">

                <span id="blog-title">David Dworken's Blog</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../../archive.html">Archive</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.md" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">XSS in pypi (and Uber!)</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">David Dworken</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2016-04-17T19:41:05-04:00" itemprop="datePublished" title="2016-04-17 19:41">2016-04-17 19:41</time></a></p>
            
        <p class="sourceline"><a href="index.md" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Uber's bug bounty program just went public, so it is time to write up some of the vulnerabilities I found in Uber. One of the more interesting ones was an XSS in <code>archive.uber.com</code> due to MIME sniffing. Uber hosts a mirror of pypi (using the same software as pypi) at <code>archive.uber.com/pypi/simple/</code>. So then the question became, is there a vulnerability here. Pypi doesn't allow package names including any of the characters we would need for a normal XSS (<code>"</code>, <code>'</code>, <code>&lt;</code>, or <code>&gt;</code>) so we can't get an XSS via the package names. So what about the files?</p>
<p>When uploading a package to pypi, you simply upload a <code>.tar.gz</code> of all the requisite files (<code>setup.py</code>, etc). Pypi does not verify that what we upload is a valid <code>.tar.gz</code>, instead they simply check the file signature (the first few bytes of the file) to ensure that they are correct. </p>
<p>When downloading the <code>.tar.gz</code> from pypi, it is sent with a MIME type of <code>application/octet-stream</code>. Since <code>application/octet-stream</code> is a very vague designation, browsers will automatically try to determine the type of the file. Chrome and Firefox both do so by looking the first few bytes of the file (so they will see it as a <code>.tar.gz</code> and open a download prompt). Internet explorer scans the first 256 bytes of the file for <code>html</code> and if it finds <code>html</code> it will interpret the file as HTML. </p>
<p>So we can combine the fact that the <code>.tar.gz</code> files are not verified for validity and the vague MIME type to get a persistent XSS. We do so by creating a <code>.tar.gz</code> that contains <code>&lt;html&gt;&lt;script&gt;alert(0)&lt;/script&gt;&lt;/html&gt;</code> one can inject javascript into the page. This can be done simply by opening the file in any text editor and adding the text. </p>
<p>The final step we have to overcome is that the normal method of uploading to pypi doesn't give us a chance to edit the <code>.tar.gz</code>. So we build it (<code>python setup.py sdist</code>) and then upload it with Twine (<code>pip install twine</code> to download it) by running <code>twine upload dist/evil.tar.gz</code>. </p>
<p>I uploaded it to pypi and it was then mirrored from pypi to <code>archive.uber.com</code>. </p>
<p>I reported this to pypi on March 26th and it was fixed on March 28th. </p>
<p>I reported this to Uber's bug bounty on March 26th, it was triaged on the 28th, and patched on April 1st. A 750 dollar bounty was awarded on the 6th. You can see the report <a href="https://hackerone.com/reports/126197">here</a>. </p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../csv-injection-in-businessubercom/csv-injection-in-businessubercom/" rel="prev" title="CSV Injection in business.uber.com">Previous post</a>
            </li>
            <li class="next">
                <a href="../../xss-and-sqli-scanning-with-mitmproxy/" rel="next" title="XSS and SQLi Scanning with mitmproxy">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents Â© 2017         <a href="mailto:david@daviddworken.com">David Dworken</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
