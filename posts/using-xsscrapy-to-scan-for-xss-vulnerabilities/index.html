<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Using XSScrapy to Scan for XSS Vulnerabilities | David Dworken's Blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://blog.daviddworken.com/posts/using-xsscrapy-to-scan-for-xss-vulnerabilities/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="David Dworken">
<link rel="prev" href="../pywmata/" title="pyWMATA" type="text/html">
<link rel="next" href="../bug-bounties-list/" title="Bug Bounties List!" type="text/html">
<meta property="og:site_name" content="David Dworken's Blog">
<meta property="og:title" content="Using XSScrapy to Scan for XSS Vulnerabilities">
<meta property="og:url" content="http://blog.daviddworken.com/posts/using-xsscrapy-to-scan-for-xss-vulnerabilities/">
<meta property="og:description" content="Using XSScrapy to Scan for XSS Vulnerabilities
XSScrapy is an amazing tool for the aspiring cyber security researcher. Entering the cyber security field used to be challenging and full of hours of was">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-02-26T11:10:26-05:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top" role="navigation"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://blog.daviddworken.com/">

                <span id="blog-title">David Dworken's Blog</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>
                </li>
<li>
<a href="../../resume.pdf">Resume</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.src.html" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Using XSScrapy to Scan for XSS Vulnerabilities</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">David Dworken</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2015-02-26T11:10:26-05:00" itemprop="datePublished" title="2015-02-26 11:10">2015-02-26 11:10</time></a></p>
                <p class="commentline">
        
    <a href=".#disqus_thread" data-disqus-identifier="cache/posts/using-xsscrapy-to-scan-for-xss-vulnerabilities.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.src.html" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div class="page">
    <div class="preview-page">
    <div class="container">
      <div class="repository-with-sidebar repo-container with-full-navigation">
          <div class="repository-content context-loader-container">
            <div id="readme" class="boxed-group flush clearfix announce instapaper_body md">
              <div class="markdown-body entry-content">
<h1></h1>
<p><a href=".#using-xsscrapy-to-scan-for-xss-vulnerabilities"><span class="octicon octicon-link"></span></a>Using XSScrapy to Scan for XSS Vulnerabilities</p>
<p><a href="https://github.com/DanMcInerney/xsscrapy">XSScrapy</a> is an amazing tool for the aspiring cyber security researcher. Entering the cyber security field used to be challenging and full of hours of wasted research with nothing to show for it. With XSScrapy, that is no longer true. 
</p>
<h4></h4>
<p><a href=".#so-what-is-an-xss-vulnerability"><span class="octicon octicon-link"></span></a>So what is an XSS Vulnerability</p>
<p>A XSS vulnerability is what happens when a website displays user input without escaping this. If this makes sense to you, continue to the next section.</p>
<p>A common example of when this would happen is if the website returned the following HTML:</p>
<div class="highlight highlight-html"><pre>&lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s1"><span class="pl-pds">"</span>[Link to the current page]<span class="pl-pds">"</span></span>&gt;</pre></div>
<p>So on <code>example.com</code>, this would display:</p>
<div class="highlight highlight-html"><pre>&lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s1"><span class="pl-pds">"</span>http://example.com/<span class="pl-pds">"</span></span>&gt;</pre></div>
<p>By loading <code>example.com/"&gt;&lt;script&gt;alert(0)&lt;/script&gt;&lt;"</code>, the  HTML becomes:</p>
<div class="highlight highlight-html"><pre>&lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s1"><span class="pl-pds">"</span>example.com/<span class="pl-pds">"</span></span>&gt;<span class="pl-s2">&lt;<span class="pl-ent">script</span>&gt;<span class="pl-s3">alert</span>(<span class="pl-c1">0</span>)&lt;/<span class="pl-ent">script</span>&gt;</span>&lt;""&gt;</pre></div>
<p>Which when indented properly looks like:</p>
<div class="highlight highlight-html"><pre>&lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s1"><span class="pl-pds">"</span>example.com/<span class="pl-pds">"</span></span>&gt;
<span class="pl-s2">&lt;<span class="pl-ent">script</span>&gt;</span>
<span class="pl-s2">    <span class="pl-s3">alert</span>(<span class="pl-c1">0</span>)</span>
<span class="pl-s2">&lt;/<span class="pl-ent">script</span>&gt;</span>
&lt;""&gt;</pre></div>
<p>All of which is valid HTML and will run properly. In this case, we have injected javascript code to display a popup box. While a popup box is not dangerous, the javascript can be used to do a number of other malicious things. For example, the injected javascript could automatically exfiltrate cookies back to an attacker owned server (thus giving the attacker access to the victim's account).</p>
<h3></h3>
<p><a href=".#so-what-is-xsscrapy"><span class="octicon octicon-link"></span></a>So what is XSScrapy?</p>
<p>XSScrapy is an XSS scanner written by Dan McInerney in Python. XSScrapy works by using scrapy to create a web spider to download the HTML of all pages on a given domain name. Scrapy finds URLs by automatically following all of the links on the website until it has scanned every single URL. Once the HTML for a page is downloaded, XSScrapy automatically searches the page for XSS vulnerabilities.</p>
<p>This is done by looking for a number of common injection points and injecting the string <code>9zqjxel'"(){}&lt;x&gt;:9zqjxel;9</code>. The important part of this string is <code>'"(){}&lt;x&gt;:;</code>. This string contains pretty much every possibly "dangerous" character. So if the HTML is rendered without those characters being escaped, it is likely that there is an XSS vulnerability.</p>
<h3></h3>
<p><a href=".#ok-lets-start-scanning"><span class="octicon octicon-link"></span></a>Ok, let's start scanning!</p>
<p>First, follow the installation instructions <a href="https://github.com/DanMcInerney/xsscrapy/blob/master/README.md">here</a>. Once you have done that, let's find a website to scan.</p>
<p><strong>Never</strong> run XSScrapy against a domain that you do not own or have permission to penetration test. So if you are looking for a website to practice your new found skills on, try any website that offers a bug bounty. Look on websites like Bug Crowd, Hacker One, or CrowdCurity to find websites that allow for automated scanning.</p>
<p>Once you found one, run:</p>
<p><code>xsscrapy.py -u http://example.com</code></p>
<p>Once the scan is finished, let's look through the <code>xsscrapy-vulns.txt</code> file. So run <code>cat xsscrapy-vulns.txt</code>. (Assuming the program found some potential vulnerabilities) This should give you a nice list of vulnerabilities in the form of:</p>
<pre><code>URL: [URL of the Vulnerability]
response URL: [URL of the Vulnerability]
Unfiltered: [The code causing the problem]
Payload: [What was injected to trigger the problem]
Type: [Type of Vulnerability]
Injection point: [Where the payload was injected]
Possible payloads: [A suggested payload to exploit: Note this is often incorrect]
Line: [The problematic line of HTML code]
`&lt;/pre&gt;

So now lets go through an example vulnerability report line by line. 

&lt;pre&gt;`URL: www.example.com/?q=9zqjxxe'"(){}&lt;x&gt;:9zqjxxe;9
response URL: www.example.com/?q=9zqjxxe'"(){}&lt;x&gt;:9zqjxxe;9
Unfiltered: '"(){}&lt;x&gt;
Payload: 9zqjxxe'"(){}&lt;x&gt;:9zqjxxe;9
Type: form
Injection point: q
Possible payloads: x"/onmouseover=prompt(9)/", x"x&gt;&lt;svG/onLoad=prompt(9)&gt;, x" onmouseover=prompt(9) "
Line:  &lt;input type="hidden" name="q" value="9zqjxgm'"(){}&lt;x&gt;:9zqjxgm;9
`&lt;/pre&gt;

### 
[&lt;span class="octicon octicon-link"&gt;&lt;/span&gt;](#developing-the-exploit-if-type--form)Developing the Exploit (if Type == form)

Take the URL from the first line and load it in your browser `www.example.com/?q=9zqjxxe'"(){}&lt;x&gt;:9zqjxxe;9`

Now modify the URL to `www.example.com/?q=`

Then look at the the last line of XSScrapy's vulnerability report: 

&lt;pre&gt;`Line:  &lt;input type="hidden" name="q" value="9zqjxgm'"(){}&lt;x&gt;:9zqjxgm;9
</code></pre>
<p>So based off of the above except from the HTML, we can tell that we want to first add a <code>"</code> to escape from the value variable followed by a <code>&gt;</code> to escape out into the HTML. Together, these two characters will get all following text to be interpreted as HTML. So now that we have that done, we simply tack a standard <code>&lt;script&gt;alert(0)&lt;/script&gt;</code> onto the end of <code>"&gt;</code> making our final input <code>"&gt;&lt;script&gt;alert(0)&lt;/script&gt;</code>. So now we have our payload.</p>
<p>Take that payload and add it on to the URL we got earlier (<code>www.example.com/?q=</code>) to make <code>www.example.com/?q="&gt;&lt;script&gt;alert(0)&lt;/script&gt;</code>. Then load that URL, and you should get a pop up box displaying <code>0</code>!</p>
<p>Now that you have gotten this far, the final step is to report the vulnerability to the website. Create an account on what ever bug bounty website they use and submit it. If you've gotten this far, then Congratulations! You've reported your first vulnerability.</p>
<pre><code>          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
  </div>
  </div>
</div>
</div>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../pywmata/" rel="prev" title="pyWMATA">Previous post</a>
            </li>
            <li class="next">
                <a href="../bug-bounties-list/" rel="next" title="Bug Bounties List!">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="dworken",
            disqus_url="http://blog.daviddworken.com/posts/using-xsscrapy-to-scan-for-xss-vulnerabilities/",
        disqus_title="Using XSScrapy to Scan for XSS Vulnerabilities",
        disqus_identifier="cache/posts/using-xsscrapy-to-scan-for-xss-vulnerabilities.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="dworken";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:david@daviddworken.com">David Dworken</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-74048408-1","auto"),ga("send","pageview");</script>
</body>
</html>
